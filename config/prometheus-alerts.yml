
groups:

  # ============================================================================
  # ALERTAS DA APLICAÇÃO SCHEMA REGISTRY
  # ============================================================================
  - name: schema-registry-app
    rules:

      # Schema Registry está inacessível
      - alert: SchemaRegistryDown
        expr: up{job="schema-registry-app"} == 0
        for: 1m
        labels:
          severity: critical
          service: schema-registry
          team: platform
        annotations:
          summary: "Schema Registry está inacessível"
          description: "O Schema Registry não está respondendo há mais de 1 minuto. Instance: {{ $labels.instance }}"
          runbook_url: "https://github.com/your-org/schema-registry/runbooks/schema-registry-down.md"

      # Alta taxa de erro HTTP
      - alert: HighErrorRate
        expr: |
          (
            rate(http_requests_total{job="schema-registry-app", status=~"5.."}[5m])
            /
            rate(http_requests_total{job="schema-registry-app"}[5m])
          ) * 100 > 10
        for: 2m
        labels:
          severity: warning
          service: schema-registry
        annotations:
          summary: "Alta taxa de erro no Schema Registry"
          description: "Taxa de erro HTTP 5xx está acima de 10% por mais de 2 minutos. Valor atual: {{ $value }}%"

      # Alta latência nas requisições
      - alert: HighRequestLatency
        expr: |
          histogram_quantile(0.95, rate(schema_registry_request_duration_seconds_bucket[5m])) > 1
        for: 3m
        labels:
          severity: warning
          service: schema-registry
        annotations:
          summary: "Alta latência no Schema Registry"
          description: "95% das requisições estão levando mais de 1 segundo. Valor atual: {{ $value }}s"

      # Poucos registros de schema (possível problema)
      - alert: LowSchemaRegistrationRate
        expr: |
          rate(schema_registry_registrations_total[10m]) < 0.1
        for: 10m
        labels:
          severity: info
          service: schema-registry
        annotations:
          summary: "Baixa taxa de registro de schemas"
          description: "Taxa de registro de schemas está abaixo de 0.1/s por mais de 10 minutos"
