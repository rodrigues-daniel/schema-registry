groups:
  - name: schema-registry-alerts
    rules:
      # Alertas da aplicação
      - alert: SchemaRegistryDown
        expr: up{job="schema-registry-app"} == 0
        for: 1m
        labels:
          severity: critical
          service: schema-registry
        annotations:
          summary: "Schema Registry está inacessível"
          description: "O Schema Registry não está respondendo há mais de 1 minuto."

      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
          service: schema-registry
        annotations:
          summary: "Alta taxa de erro no Schema Registry"
          description: "Taxa de erro HTTP 5xx está acima de 10% por mais de 2 minutos."

      - alert: HighLatency
        expr: histogram_quantile(0.95, rate(schema_registry_request_duration_seconds_bucket[5m])) > 1
        for: 3m
        labels:
          severity: warning
          service: schema-registry
        annotations:
          summary: "Alta latência no Schema Registry"
          description: "95% das requisições estão levando mais de 1 segundo."

      # Alertas do NATS embutido
      - alert: NATSConnectionIssues
        expr: nats_embedded_connections_total == 0
        for: 30s
        labels:
          severity: critical
          service: nats-embedded
        annotations:
          summary: "Problemas de conexão com NATS embutido"
          description: "Não há conexões ativas com o NATS embutido."

      - alert: JetStreamHighMemory
        expr: nats_jetstream_storage_bytes{type="memory"} > 1073741824  # 1GB
        for: 5m
        labels:
          severity: warning
          service: nats-embedded
        annotations:
          summary: "Alto uso de memória no JetStream"
          description: "Uso de memória do JetStream está acima de 1GB por mais de 5 minutos."

      - alert: KVStoreErrors
        expr: rate(nats_kv_operations_total{operation=~"put|get"}[5m]) == 0
        for: 2m
        labels:
          severity: warning
          service: nats-embedded
        annotations:
          summary: "Possíveis problemas no KV Store"
          description: "Não há operações no KV Store há mais de 2 minutos."